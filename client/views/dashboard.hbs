{{> sidebar title='dashboard'}}
<div class="content">
    <div class="window">
        <div class="row success" style="display:none;">
            <div class="col-lg-12">
                <div class="stat card text-white bg-dark mb-3">
                    <div class="card-body">
                        <h4 class="card-title"><i class="fa fa-check-circle" aria-hidden="true"></i> Payout successful</h4>
                        <p class="card-text">
                            Eth Price: $<span id="price">0</span>
                            <ul id="hashes"></ul>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4">
                <div class="stat card text-white bg-dark mb-3">
                    <div class="card-body">
                        <h4 class="card-title">{{count}}</h4>
                        <p class="card-text">Total Employees</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="stat card text-white bg-dark mb-3">
                    <div class="card-body">
                        <h4 class="card-title">${{total}}</h4>
                        <p class="card-text">Total Expense</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="stat card text-white bg-dark mb-3">
                    <div class="card-body">
                        <h4 class="card-title">1</h4>
                        <p class="card-text">Unused box</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-8">
                <div class="card text-white bg-dark">
                    <h4 class="card-header">Employees</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th></th>
                                <th scope="col">Name</th>
                                <th scope="col">ETH Address</th>
                                <th scope="col">Salary</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each employees}}
                            <tr>
                                <td><button  id="{{this.address}}" class="remove btn-link">x</button></td>
                                <td>{{this.name}}</td>
                                <td>{{this.address}}</td>
                                <td>${{this.salary}}</td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
                <button type="button" class="btn btn-dark" id="pay">ðŸ’¸ Payout {{count}} Employees with ${{total}}</a>
            </div>

            <div class="col-lg-4">
                <div class="card text-white bg-dark">
                    <h4 class="card-header">Add Employee</h4>
                    <div class="card-body">
                        <form>
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" class="form-control" id="name" aria-describedby="emailHelp" placeholder="Enter Name">
                                <small id="emailHelp" class="form-text text-muted">The employee's name</small>
                            </div>
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input type="text" class="form-control" id="address" aria-describedby="addressHelp" placeholder="Enter Address">
                                <small id="addressHelp" class="form-text text-muted">The employee's ETH wallet address</small>
                            </div>
                            <div class="form-group">
                                <label for="name">Salary</label>
                                <input type="number" class="form-control" id="salary" aria-describedby="salaryHelp" placeholder="Enter Salary">
                                <small id="salaryHelp" class="form-text text-muted">The employee's bi-weekly salary</small>
                            </div>
                            <button id="addEmployee" type="submit" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Payment Functionality -->
<script>
$(()=>{
    $('#addEmployee').click((event)=>{
        event.preventDefault();

        let newEmployee = {
            name: $("#name").val(),
            address: $("#address").val(),
            salary: $("#salary").val()
        }

        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(newEmployee),
            success: () => { location.reload() },
            error: () => { console.log("boo") },
            url: '/employee/new',
            cache: false
        });
    });

    $('.remove').click((event)=>{
        event.preventDefault();
        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ address: event.currentTarget.id }),
            success: () => { location.reload() },
            error: () => { console.log("boo") },
            url: '/employee/remove',
            cache: false
        });
    });

    $('#pay').click(()=>{
        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({{{json employees}}}),
            success: (data) => {
                $('.success').show();
                for(let h = 0; h < data.hashes.length; h++)
                {
                    $('#hashes').append("<li>Transaction to: <a href='https://etherscan.io/tx/"+ data.hashes[h] +"'>"+data.employees[h]+"</a></li>");
                }
                $('#price').html(data.price);
            },
            error: () => { console.log("boo") },
            url: '/pay',
            cache: false
        });
    });
});
</script>
